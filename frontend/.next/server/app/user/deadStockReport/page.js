(()=>{var e={};e.id=1645,e.ids=[1645],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12174:(e,t,r)=>{Promise.resolve().then(r.bind(r,26758))},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},26758:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});let a=(0,r(20413).registerClientReference)(function(){throw Error("Attempted to call the default export of \"D:\\\\pstu_inventory_management\\\\frontend\\\\app\\\\user\\\\deadStockReport\\\\page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"D:\\pstu_inventory_management\\frontend\\app\\user\\deadStockReport\\page.tsx","default")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},48140:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>y});var a=r(28625),s=r(64996),o=r(55136),n=r(55918),i=r(1332),l=r(55313),d=r(57144),c=r(5106),u=r(29965),m=r(99741),p=r(68885),h=r(79285),x=r(93948),f=r.n(x);function y(){let[e,t]=(0,s.useState)({id:"",name:"",email:"",department:"",office:""}),[r,x]=(0,s.useState)({productName:"",quantity:"",reason:""}),[y,g]=(0,s.useState)(null),[b,v]=(0,s.useState)(""),[N,j]=(0,s.useState)([]),[k,C]=(0,s.useState)(!1),[q,w]=(0,s.useState)([]),[S,_]=(0,s.useState)({}),[P,R]=(0,s.useState)(!1),[D,A]=(0,s.useState)(!1),[E,F]=(0,s.useState)(!1),[I,$]=(0,s.useState)({}),[J,L]=(0,s.useState)(""),T=(0,s.useRef)(null),G=(0,s.useRef)(null),O=async t=>{if(t&&e.id){R(!0);try{let r=await fetch(`http://localhost:5000/api/currentstockouts/quantity?user_id=${e.id}&item_id=${t}`);if(r.ok){let e=await r.json(),a=0;Array.isArray(e)&&e.length>0?a=e[0].quantity||0:void 0!==e.totalQuantity?a=e.totalQuantity:void 0!==e.quantity&&(a=e.quantity),_(e=>({...e,[t]:a}))}}catch(e){console.error("Error fetching stock count:",e)}finally{R(!1)}}},Q=e=>{if(Y("productName",e),e.trim().length>0){let t=N.filter(t=>t.name.toLowerCase().includes(e.toLowerCase()));w(t),C(t.length>0)}else C(!1),w([])},z=e=>{x(t=>({...t,productName:e.name})),C(!1),w([]),$(e=>{let t={...e};return delete t.productName,delete t.quantity,t}),O(e.id)},B=()=>{g(null),v(""),G.current&&(G.current.value="")},U=()=>{let t={};r.productName.trim()||(t.productName="Product name is required");let a=r.quantity.trim();if(a){let e=Number(a);if(isNaN(e)||e<=0)t.quantity="Quantity must be a positive number";else{let a=N.find(e=>e.name===r.productName);if(a){let r=S[a.id]||0;e>r&&(t.quantity=`Quantity cannot exceed available stock (${r} available)`)}}}else t.quantity="Quantity is required";return r.reason.trim()||(t.reason="Reason for dead stock is required"),y||(t.image="Image is required"),e.id&&"undefined"!==e.id&&""!==e.id.trim()||(t.user="User information not found. Please log in again."),$(t),0===Object.keys(t).length},M=async t=>{if(t.preventDefault(),L(""),F(!1),U()){if(!e.id||"undefined"===e.id||""===e.id.trim()){L("Error: User ID not found. Please log in again.");return}A(!0);try{let t;let a=N.find(e=>e.name===r.productName);if(!a){$({productName:"Please select a product from the dropdown list"}),A(!1);return}let s=e.id?.toString(),o=a.id,n=Number.parseInt(r.quantity),i=r.reason||"",l=new FormData;l.append("user_id",s),l.append("item_id",o),l.append("quantity",n.toString()),l.append("reason",i),y&&l.append("image",y,y.name);let d=await fetch("http://localhost:5000/api/deadstockrequests/create",{method:"POST",body:l}),c=await d.text();try{t=JSON.parse(c)}catch(e){console.error("Failed to parse response as JSON",e),L(`Server error (${d.status}): ${c||"No response body"}`),A(!1);return}if(!d.ok){console.error("Error from backend:",t);let e=t.message||t.error||"Error submitting form. Please try again.";L(e);return}F(!0),x({productName:"",quantity:"",reason:""}),g(null),v(""),$({})}catch(e){console.error("Error submitting form:",e),L(e instanceof Error?e.message:"An error occurred. Please try again.")}finally{A(!1)}}},Y=(e,t)=>{x(r=>({...r,[e]:t})),I[e]&&$(t=>{let r={...t};return delete r[e],r})};return(0,a.jsxs)("div",{className:"max-w-4xl mx-auto p-4",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("div",{className:"flex items-center space-x-4 mb-4",children:(0,a.jsx)(f(),{href:"/",children:(0,a.jsxs)(n.$,{variant:"outline",size:"sm",className:"bg-transparent",style:{borderColor:"#e7e7e7",color:"#51247a"},children:[(0,a.jsx)(u.A,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]})})}),(0,a.jsx)("h2",{className:"text-2xl font-bold mb-2",style:{color:"#51247a"},children:"Report Dead Stock"}),(0,a.jsx)("p",{style:{color:"#666"},children:"Submit a dead stock report for admin review and processing"})]}),(0,a.jsxs)(o.Zp,{style:{borderColor:"#e7e7e7",backgroundColor:"#ffffff"},children:[(0,a.jsxs)(o.aR,{children:[(0,a.jsx)(o.ZB,{style:{color:"#51247a"},children:"Dead Stock Report Details"}),(0,a.jsx)(o.BT,{style:{color:"#666"},children:"Fill in all required fields. Your report will be reviewed by the admin."})]}),(0,a.jsx)(o.Wu,{children:(0,a.jsxs)("form",{onSubmit:M,className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(l.J,{style:{color:"#51247a"},children:"Your Name"}),(0,a.jsx)("div",{className:"px-3 py-2 bg-gray-50 rounded-md border",style:{borderColor:"#e7e7e7",color:"#666"},children:e.name||"Loading..."})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2 relative",children:[(0,a.jsx)(l.J,{htmlFor:"productName",style:{color:"#51247a"},children:"Product Name *"}),(0,a.jsx)(i.p,{id:"productName",ref:T,value:r.productName,onChange:e=>Q(e.target.value),onFocus:()=>{N.length>0&&(w(r.productName.trim()?N.filter(e=>e.name.toLowerCase().includes(r.productName.toLowerCase())):N),C(!0))},onBlur:()=>{setTimeout(()=>C(!1),200)},placeholder:"Enter or select product name",autoComplete:"off",style:{borderColor:I.productName?"#ef4444":"#e7e7e7"}}),k&&q.length>0&&(0,a.jsx)("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border rounded-md shadow-lg z-10",style:{borderColor:"#e7e7e7"},children:q.slice(0,8).map((e,t)=>(0,a.jsx)("button",{type:"button",className:"w-full text-left px-3 py-2 hover:bg-gray-100",onClick:()=>z(e),children:(0,a.jsx)("div",{style:{color:"#51247a"},className:"font-medium",children:e.name})},t))}),I.productName&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:I.productName})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(l.J,{htmlFor:"quantity",style:{color:"#51247a"},children:["Quantity * ",r.productName&&(0,a.jsx)("span",{style:{color:"#666"},className:"text-sm font-normal",children:P?" (Loading stock...)":(0,a.jsxs)(a.Fragment,{children:[" ","(Available:"," ",S[N.find(e=>e.name===r.productName)?.id||""]||0,")"]})})]}),(0,a.jsx)(i.p,{id:"quantity",type:"number",value:r.quantity,onChange:e=>Y("quantity",e.target.value),placeholder:"Enter quantity of dead stock",style:{borderColor:I.quantity?"#ef4444":"#e7e7e7"}}),I.quantity&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:I.quantity})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(l.J,{htmlFor:"reason",style:{color:"#51247a"},children:"Reason for Dead Stock *"}),(0,a.jsx)(d.T,{id:"reason",value:r.reason,onChange:e=>Y("reason",e.target.value),placeholder:"Enter reason for marking this item as dead stock (e.g., expired, damaged, obsolete, etc.)",style:{borderColor:I.reason?"#ef4444":"#e7e7e7"},rows:5}),I.reason&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:I.reason})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(l.J,{htmlFor:"image",style:{color:"#51247a"},children:"Upload Image *"}),(0,a.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-6 text-center cursor-pointer hover:bg-gray-50 transition",style:{borderColor:I.image?"#ef4444":"#e7e7e7",backgroundColor:I.image?"#fef2f2":"transparent"},onClick:()=>G.current?.click(),children:[(0,a.jsx)("input",{ref:G,type:"file",id:"image",accept:"image/*",onChange:e=>{let t=e.target.files?.[0];if(t){g(t);let e=new FileReader;e.onloadend=()=>{v(e.result)},e.readAsDataURL(t),I.image&&$(e=>{let t={...e};return delete t.image,t})}},className:"hidden"}),b?(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("img",{src:b||"/placeholder.svg",alt:"Preview",className:"max-h-48 mx-auto rounded"}),(0,a.jsx)("p",{style:{color:"#51247a"},className:"font-medium",children:y?.name}),(0,a.jsx)(n.$,{type:"button",variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),B()},style:{borderColor:"#e7e7e7",color:"#51247a"},children:"Change Image"})]}):(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.A,{className:"w-8 h-8 mx-auto",style:{color:"#51247a"}}),(0,a.jsx)("p",{style:{color:"#51247a"},className:"font-medium",children:"Click to upload image"}),(0,a.jsx)("p",{style:{color:"#999"},className:"text-sm",children:"or drag and drop"})]})]}),I.image&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:I.image})]}),J&&(0,a.jsx)(c.Fc,{className:"border-red-300 bg-red-50",children:(0,a.jsx)(c.TN,{style:{color:"#dc2626"},children:J})}),E&&(0,a.jsx)(c.Fc,{className:"border-green-300 bg-green-50",style:{borderColor:"#22c55e",backgroundColor:"#f0fdf4"},children:(0,a.jsx)(c.TN,{style:{color:"#16a34a"},children:"Dead stock report submitted successfully! Your report is now pending admin review."})}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsxs)(n.$,{type:"submit",disabled:D,className:"flex-1",style:{backgroundColor:"#51247a",color:"white",opacity:D?.7:1},children:[(0,a.jsx)(p.A,{className:"w-4 h-4 mr-2"}),D?"Submitting...":"Submit Report"]}),(0,a.jsxs)(n.$,{type:"button",variant:"outline",onClick:()=>{x({productName:"",quantity:"",reason:""}),g(null),v(""),$({}),F(!1),L(""),_({})},style:{borderColor:"#e7e7e7",color:"#51247a"},children:[(0,a.jsx)(h.A,{className:"w-4 h-4 mr-2"}),"Clear Form"]})]})]})})]}),"true"===localStorage.getItem("debug")&&(0,a.jsxs)("div",{className:"mt-4 p-4 border rounded bg-gray-50",children:[(0,a.jsx)("h3",{className:"font-semibold mb-2",children:"Debug Info"}),(0,a.jsx)("pre",{className:"text-xs",children:JSON.stringify({currentUser:e,formData:r,hasImage:!!y,productsCount:N.length},null,2)})]})]})}},58800:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,pages:()=>c,routeModule:()=>m,tree:()=>d});var a=r(5853),s=r(60554),o=r(30708),n=r.n(o),i=r(8067),l={};for(let e in i)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>i[e]);r.d(t,l);let d={children:["",{children:["user",{children:["deadStockReport",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,26758)),"D:\\pstu_inventory_management\\frontend\\app\\user\\deadStockReport\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,80216)),"D:\\pstu_inventory_management\\frontend\\app\\user\\layout.tsx"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,31077))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,97898)),"D:\\pstu_inventory_management\\frontend\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,92192,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,82137,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,48358,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,31077))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["D:\\pstu_inventory_management\\frontend\\app\\user\\deadStockReport\\page.tsx"],u={require:r,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:s.RouteKind.APP_PAGE,page:"/user/deadStockReport/page",pathname:"/user/deadStockReport",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},75222:(e,t,r)=>{Promise.resolve().then(r.bind(r,48140))},79551:e=>{"use strict";e.exports=require("url")}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[9683,9139,4405,6864],()=>r(58800));module.exports=a})();