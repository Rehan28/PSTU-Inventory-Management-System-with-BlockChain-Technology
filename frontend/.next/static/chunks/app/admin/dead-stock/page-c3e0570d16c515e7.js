(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2962],{5455:(e,s,t)=>{Promise.resolve().then(t.bind(t,75987))},40447:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(87982).A)("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},60531:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(87982).A)("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]])},72196:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(87982).A)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},75987:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>C});var a=t(73365),r=t(1521),l=t(86170),n=t(58600),c=t(87812),d=t(66009),i=t(10096),o=t(69060),x=t(23060),m=t(63678),h=t(40447),u=t(46080),j=t(37216),f=t(2262),p=t(16296),y=t(60531),g=t(27521),b=t(97911),N=t(14840),w=t(72196),v=t(59534),k=t.n(v);function C(){let[e,s]=(0,r.useState)([]),[t,v]=(0,r.useState)(!0),[C,A]=(0,r.useState)(""),[_,R]=(0,r.useState)("All Reasons"),[S,q]=(0,r.useState)("All Roles"),[E,D]=(0,r.useState)([]),[T,L]=(0,r.useState)(["All Reasons"]),[M,U]=(0,r.useState)(["All Roles"]),[$,z]=(0,r.useState)(""),[Z,F]=(0,r.useState)(1),[W,I]=(0,r.useState)(null),[P,O]=(0,r.useState)(!1),[B,J]=(0,r.useState)({quantity:0,reason:""}),[Q,V]=(0,r.useState)(!1),H="http://localhost:5000";(0,r.useEffect)(()=>{(async()=>{try{v(!0),z("");let e=await fetch("".concat(H,"/api/deadstocks/get"));if(!e.ok)throw Error("Failed to fetch deadstock records");let t=await e.json(),a=await fetch("".concat(H,"/api/users/get"));if(!a.ok)throw Error("Failed to fetch users");let r=await a.json(),l=await fetch("".concat(H,"/api/items/get"));if(!l.ok)throw Error("Failed to fetch items");let n=await l.json(),c=new Map(r.map(e=>[e._id,e])),d=new Map(n.map(e=>[e._id,e])),i=t.map(e=>{let s=c.get(e.user_id),t=d.get(e.item_id);return{...e,userName:(null==s?void 0:s.name)||"Unknown User",itemName:(null==t?void 0:t.name)||"Unknown Item",userRole:(null==s?void 0:s.role)||(null==s?void 0:s.roll)||"Unknown"}});i.sort((e,s)=>new Date(s.reported_at).getTime()-new Date(e.reported_at).getTime());let o=["All Reasons",...Array.from(new Set(i.map(e=>e.reason)))],x=["All Roles",...Array.from(new Set(i.map(e=>e.userRole)))];s(i),D(i),L(o),U(x)}catch(e){console.error("Error fetching data:",e),z(e instanceof Error?e.message:"Failed to load data")}finally{v(!1)}})()},[]);let X=e=>{A(e),G(e,_,S)},G=(s,t,a)=>{let r=e;s&&(r=r.filter(e=>e.userName.toLowerCase().includes(s.toLowerCase())||e.itemName.toLowerCase().includes(s.toLowerCase())||e.reason.toLowerCase().includes(s.toLowerCase()))),"All Reasons"!==t&&(r=r.filter(e=>e.reason===t)),"All Roles"!==a&&(r=r.filter(e=>e.userRole===a)),D(r),F(1)},K=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),Y=e=>{switch(e.toLowerCase()){case"damaged":return"bg-red-100 text-red-800";case"expired":return"bg-orange-100 text-orange-800";case"obsolete":return"bg-gray-100 text-gray-800";case"lost":return"bg-yellow-100 text-yellow-800";case"stolen":return"bg-purple-100 text-purple-800";case"defective":return"bg-pink-100 text-pink-800";default:return"bg-blue-100 text-blue-800"}},ee=e=>{switch(e.toLowerCase()){case"teacher":return"bg-purple-100 text-purple-800";case"staff":return"bg-orange-100 text-orange-800";case"admin":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},es=async e=>{if(confirm("Delete deadstock record for ".concat(e.itemName,"?")))try{V(!0),(await fetch("".concat(H,"/api/deadstocks/delete/").concat(e._id),{method:"DELETE"})).ok?(await fetch("".concat(H,"/api/currentstockouts/update-quantity"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:e.user_id,item_id:e.item_id,quantity:e.quantity})}),s(s=>s.filter(s=>s._id!==e._id)),D(s=>s.filter(s=>s._id!==e._id))):alert("Failed to delete deadstock record")}catch(e){console.error("Error deleting deadstock record:",e),alert("Error deleting record")}finally{V(!1)}},et=async()=>{if(W)try{V(!0);let e=await fetch("".concat(H,"/api/deadstocks/update/").concat(W._id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(B)});if(e.ok){await e.json();let t=B.quantity-W.quantity;0!==t&&await fetch("".concat(H,"/api/currentstockouts/update-quantity"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:W.user_id,item_id:W.item_id,quantity:-t})}),s(e=>e.map(e=>e._id===W._id?{...e,quantity:B.quantity,reason:B.reason}:e)),D(e=>e.map(e=>e._id===W._id?{...e,quantity:B.quantity,reason:B.reason}:e)),O(!1),I(null)}else alert("Failed to update deadstock record")}catch(e){console.error("Error updating deadstock record:",e),alert("Error updating record")}finally{V(!1)}},ea=e=>{I(e),J({quantity:e.quantity,reason:e.reason}),O(!0)},er=(Z-1)*10,el=E.slice(er,er+10),en=Math.ceil(E.length/10);return t?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",style:{color:"#51247a"},children:"Deadstock Management"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Track and manage damaged, expired, or unusable inventory items"})]}),(0,a.jsx)(k(),{href:"/admin/deadstock/create",children:(0,a.jsxs)(n.$,{className:"text-white hover:bg-purple-700 flex items-center",style:{backgroundColor:"#51247a"},children:[(0,a.jsx)(x.A,{className:"w-4 h-4 mr-2"}),"Report Deadstock"]})})]}),(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(m.A,{className:"w-8 h-8 animate-spin mx-auto mb-4",style:{color:"#51247a"}}),(0,a.jsx)("p",{className:"text-gray-600",children:"Loading deadstock records..."})]})})]}):$?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",style:{color:"#51247a"},children:"Deadstock Management"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Track and manage damaged, expired, or unusable inventory items"})]}),(0,a.jsx)(k(),{href:"/admin/deadstock/create",children:(0,a.jsxs)(n.$,{className:"text-white hover:bg-purple-700 flex items-center",style:{backgroundColor:"#51247a"},children:[(0,a.jsx)(x.A,{className:"w-4 h-4 mr-2"}),"Report Deadstock"]})})]}),(0,a.jsx)(l.Zp,{style:{borderColor:"#e7e7e7",backgroundColor:"#ffffff"},children:(0,a.jsx)(l.Wu,{className:"p-6",children:(0,a.jsxs)("div",{className:"text-center text-red-600",children:[(0,a.jsx)("p",{className:"font-medium",children:"Error loading data"}),(0,a.jsx)("p",{className:"text-sm mt-1",children:$}),(0,a.jsx)(n.$,{onClick:()=>window.location.reload(),className:"mt-4",variant:"outline",children:"Retry"})]})})})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold",style:{color:"#51247a"},children:"Deadstock Management"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Track and manage damaged, expired, or unusable inventory items"})]}),(0,a.jsx)(k(),{href:"/admin/deadstock/create",children:(0,a.jsxs)(n.$,{className:"text-white hover:bg-purple-700 flex items-center",style:{backgroundColor:"#51247a"},children:[(0,a.jsx)(x.A,{className:"w-4 h-4 mr-2"}),"Report Deadstock"]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsx)(l.Zp,{style:{borderColor:"#e7e7e7",backgroundColor:"#ffffff"},children:(0,a.jsx)(l.Wu,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Total Deadstock"}),(0,a.jsx)("p",{className:"text-2xl font-bold",style:{color:"#51247a"},children:e.length})]}),(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center",style:{backgroundColor:"#fef2f2"},children:(0,a.jsx)(h.A,{className:"w-4 h-4 text-red-600"})})]})})}),(0,a.jsx)(l.Zp,{style:{borderColor:"#e7e7e7",backgroundColor:"#ffffff"},children:(0,a.jsx)(l.Wu,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Total Quantity Lost"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-red-600",children:e.reduce((e,s)=>e+s.quantity,0)})]}),(0,a.jsx)("div",{className:"w-8 h-8 bg-red-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(u.A,{className:"w-4 h-4 text-red-600"})})]})})}),(0,a.jsx)(l.Zp,{style:{borderColor:"#e7e7e7",backgroundColor:"#ffffff"},children:(0,a.jsx)(l.Wu,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Reporters"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:new Set(e.map(e=>e.user_id)).size})]}),(0,a.jsx)("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(j.A,{className:"w-4 h-4 text-blue-600"})})]})})}),(0,a.jsx)(l.Zp,{style:{borderColor:"#e7e7e7",backgroundColor:"#ffffff"},children:(0,a.jsx)(l.Wu,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"Damaged Items"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-orange-600",children:e.filter(e=>"Damaged"===e.reason).length})]}),(0,a.jsx)("div",{className:"w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(f.A,{className:"w-4 h-4 text-orange-600"})})]})})})]}),(0,a.jsxs)(l.Zp,{style:{borderColor:"#e7e7e7",backgroundColor:"#ffffff"},children:[(0,a.jsxs)(l.aR,{children:[(0,a.jsx)(l.ZB,{style:{color:"#51247a"},children:"Deadstock Records"}),(0,a.jsxs)(l.BT,{children:["View and manage all deadstock reports (",E.length," total)"]})]}),(0,a.jsxs)(l.Wu,{children:[(0,a.jsxs)("div",{className:"flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-4 mb-6",children:[(0,a.jsxs)("div",{className:"relative flex-1 max-w-sm",children:[(0,a.jsx)(p.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,a.jsx)(c.p,{placeholder:"Search by user, item, reason...",value:C,onChange:e=>X(e.target.value),className:"pl-10 focus:border-purple-500",style:{borderColor:"#e7e7e7"}})]}),(0,a.jsxs)(i.l6,{value:_,onValueChange:e=>{R(e),G(C,e,S)},children:[(0,a.jsx)(i.bq,{className:"w-48 focus:border-purple-500",style:{borderColor:"#e7e7e7"},children:(0,a.jsx)(i.yv,{})}),(0,a.jsx)(i.gC,{children:T.map(e=>(0,a.jsx)(i.eb,{value:e,children:e},e))})]}),(0,a.jsxs)(i.l6,{value:S,onValueChange:e=>{q(e),G(C,_,e)},children:[(0,a.jsx)(i.bq,{className:"w-48 focus:border-purple-500",style:{borderColor:"#e7e7e7"},children:(0,a.jsx)(i.yv,{})}),(0,a.jsx)(i.gC,{children:M.map(e=>(0,a.jsx)(i.eb,{value:e,children:e},e))})]})]}),(0,a.jsx)("div",{className:"rounded-md border",style:{borderColor:"#e7e7e7"},children:(0,a.jsxs)(o.XI,{children:[(0,a.jsx)(o.A0,{children:(0,a.jsxs)(o.Hj,{style:{backgroundColor:"#f8fafc"},children:[(0,a.jsx)(o.nd,{style:{color:"#51247a"},children:"No"}),(0,a.jsx)(o.nd,{style:{color:"#51247a"},children:"Reporter"}),(0,a.jsx)(o.nd,{style:{color:"#51247a"},children:"Item"}),(0,a.jsx)(o.nd,{style:{color:"#51247a"},children:"Quantity"}),(0,a.jsx)(o.nd,{style:{color:"#51247a"},children:"Reason"}),(0,a.jsx)(o.nd,{style:{color:"#51247a"},children:"Role"}),(0,a.jsx)(o.nd,{style:{color:"#51247a"},children:"Reported Date"}),(0,a.jsx)(o.nd,{style:{color:"#51247a"},children:"Actions"})]})}),(0,a.jsx)(o.BF,{children:el.map((e,s)=>(0,a.jsxs)(o.Hj,{className:"hover:bg-gray-50",children:[(0,a.jsx)(o.nA,{children:(0,a.jsx)("span",{className:"font-medium text-gray-900",children:er+s+1})}),(0,a.jsx)(o.nA,{children:(0,a.jsx)("div",{children:(0,a.jsx)("p",{className:"font-medium text-gray-900",children:e.userName})})}),(0,a.jsx)(o.nA,{children:(0,a.jsx)("p",{className:"font-medium text-gray-900",children:e.itemName})}),(0,a.jsx)(o.nA,{children:(0,a.jsx)(d.E,{variant:"outline",className:"text-xs",children:e.quantity})}),(0,a.jsx)(o.nA,{children:(0,a.jsx)(d.E,{className:"text-xs ".concat(Y(e.reason)),children:e.reason})}),(0,a.jsx)(o.nA,{children:(0,a.jsx)(d.E,{className:"text-xs ".concat(ee(e.userRole)),children:e.userRole})}),(0,a.jsx)(o.nA,{children:(0,a.jsx)("p",{className:"text-sm text-gray-600",children:K(e.reported_at)})}),(0,a.jsx)(o.nA,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(n.$,{size:"sm",variant:"outline",className:"border-blue-200 text-blue-600 hover:bg-blue-50 bg-transparent",onClick:()=>ea(e),disabled:Q,children:(0,a.jsx)(y.A,{className:"w-3 h-3"})}),(0,a.jsx)(n.$,{size:"sm",variant:"outline",className:"border-red-200 text-red-600 hover:bg-red-50 bg-transparent",onClick:()=>es(e),disabled:Q,children:(0,a.jsx)(g.A,{className:"w-3 h-3"})})]})})]},e._id))})]})}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-4",children:[(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Page ",Z," of ",en||1," (",E.length," total records)"]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(n.$,{size:"sm",variant:"outline",onClick:()=>F(e=>Math.max(e-1,1)),disabled:1===Z,children:(0,a.jsx)(b.A,{className:"w-4 h-4"})}),(0,a.jsx)(n.$,{size:"sm",variant:"outline",onClick:()=>F(e=>Math.min(e+1,en)),disabled:Z===en,children:(0,a.jsx)(N.A,{className:"w-4 h-4"})})]})]}),0===E.length&&!t&&(0,a.jsx)("div",{className:"text-center py-8",children:(0,a.jsx)("p",{className:"text-gray-500",children:"No deadstock records found matching your search criteria."})})]})]}),P&&W&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)(l.Zp,{className:"w-full max-w-md",style:{borderColor:"#e7e7e7"},children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",style:{borderColor:"#e7e7e7"},children:[(0,a.jsx)("h3",{className:"text-lg font-semibold",style:{color:"#51247a"},children:"Update Deadstock"}),(0,a.jsx)("button",{onClick:()=>O(!1),className:"text-gray-500 hover:text-gray-700",children:(0,a.jsx)(w.A,{className:"w-5 h-5"})})]}),(0,a.jsxs)(l.Wu,{className:"p-6 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Item"}),(0,a.jsx)("p",{className:"text-gray-900 font-medium",children:W.itemName})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity"}),(0,a.jsx)(c.p,{type:"number",value:B.quantity,onChange:e=>J({...B,quantity:Number.parseInt(e.target.value)||0}),className:"focus:border-purple-500",style:{borderColor:"#e7e7e7"}})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason"}),(0,a.jsx)(c.p,{value:B.reason,onChange:e=>J({...B,reason:e.target.value}),className:"focus:border-purple-500",style:{borderColor:"#e7e7e7"}})]}),(0,a.jsxs)("div",{className:"flex space-x-3 pt-4",children:[(0,a.jsx)(n.$,{onClick:et,className:"flex-1 text-white",style:{backgroundColor:"#51247a"},disabled:Q,children:Q?"Updating...":"Update"}),(0,a.jsx)(n.$,{onClick:()=>O(!1),variant:"outline",className:"flex-1",disabled:Q,children:"Cancel"})]})]})]})})]})}}},e=>{var s=s=>e(e.s=s);e.O(0,[3096,9924,7976,4973,8949,2347,4870,7358],()=>s(5455)),_N_E=e.O()}]);