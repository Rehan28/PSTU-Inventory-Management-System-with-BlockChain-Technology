(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1645],{642:(e,t,r)=>{Promise.resolve().then(r.bind(r,87164))},1941:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(87982).A)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},17067:(e,t,r)=>{"use strict";r.d(t,{hO:()=>n,sG:()=>i});var a=r(1521),s=r(98196),o=r(20544),l=r(73365),i=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"].reduce((e,t)=>{let r=a.forwardRef((e,r)=>{let{asChild:a,...s}=e,i=a?o.DX:t;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,l.jsx)(i,{...s,ref:r})});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{});function n(e,t){e&&s.flushSync(()=>e.dispatchEvent(t))}},24209:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(87982).A)("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]])},25092:(e,t,r)=>{"use strict";r.d(t,{b:()=>i});var a=r(1521),s=r(17067),o=r(73365),l=a.forwardRef((e,t)=>(0,o.jsx)(s.sG.label,{...e,ref:t,onMouseDown:t=>{var r;t.target.closest("button, input, select, textarea")||(null===(r=e.onMouseDown)||void 0===r||r.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));l.displayName="Label";var i=l},39386:(e,t,r)=>{"use strict";r.d(t,{Fc:()=>n,TN:()=>c,XL:()=>d});var a=r(73365),s=r(1521),o=r(82934),l=r(69671);let i=(0,o.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),n=s.forwardRef((e,t)=>{let{className:r,variant:s,...o}=e;return(0,a.jsx)("div",{ref:t,role:"alert",className:(0,l.cn)(i({variant:s}),r),...o})});n.displayName="Alert";let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("h5",{ref:t,className:(0,l.cn)("mb-1 font-medium leading-none tracking-tight",r),...s})});d.displayName="AlertTitle";let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,l.cn)("text-sm [&_p]:leading-relaxed",r),...s})});c.displayName="AlertDescription"},53441:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(87982).A)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},58600:(e,t,r)=>{"use strict";r.d(t,{$:()=>d});var a=r(73365),s=r(1521),o=r(20544),l=r(82934),i=r(69671);let n=(0,l.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),d=s.forwardRef((e,t)=>{let{className:r,variant:s,size:l,asChild:d=!1,...c}=e,u=d?o.DX:"button";return(0,a.jsx)(u,{className:(0,i.cn)(n({variant:s,size:l,className:r})),ref:t,...c})});d.displayName="Button"},67674:(e,t,r)=>{"use strict";r.d(t,{T:()=>l});var a=r(73365),s=r(1521),o=r(69671);let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("textarea",{className:(0,o.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...s})});l.displayName="Textarea"},69671:(e,t,r)=>{"use strict";r.d(t,{cn:()=>o});var a=r(74584),s=r(22292);function o(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,s.QP)((0,a.$)(t))}},72770:(e,t,r)=>{"use strict";r.d(t,{J:()=>d});var a=r(73365),s=r(1521),o=r(25092),l=r(82934),i=r(69671);let n=(0,l.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)(o.b,{ref:t,className:(0,i.cn)(n(),r),...s})});d.displayName=o.b.displayName},81849:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(87982).A)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},86170:(e,t,r)=>{"use strict";r.d(t,{BT:()=>d,Wu:()=>c,ZB:()=>n,Zp:()=>l,aR:()=>i});var a=r(73365),s=r(1521),o=r(69671);let l=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...s})});l.displayName="Card";let i=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",r),...s})});i.displayName="CardHeader";let n=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("text-2xl font-semibold leading-none tracking-tight",r),...s})});n.displayName="CardTitle";let d=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",r),...s})});d.displayName="CardDescription";let c=s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("p-6 pt-0",r),...s})});c.displayName="CardContent",s.forwardRef((e,t)=>{let{className:r,...s}=e;return(0,a.jsx)("div",{ref:t,className:(0,o.cn)("flex items-center p-6 pt-0",r),...s})}).displayName="CardFooter"},87164:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>x});var a=r(73365),s=r(1521),o=r(86170),l=r(58600),i=r(87812),n=r(72770),d=r(67674),c=r(39386),u=r(1941),m=r(81849),f=r(53441),p=r(24209),g=r(59534),h=r.n(g);function x(){var e;let[t,r]=(0,s.useState)({id:"",name:"",email:"",department:"",office:""}),[g,x]=(0,s.useState)({productName:"",quantity:"",reason:""}),[y,v]=(0,s.useState)(null),[b,N]=(0,s.useState)(""),[j,w]=(0,s.useState)([]),[k,C]=(0,s.useState)(!1),[S,q]=(0,s.useState)([]),[R,A]=(0,s.useState)({}),[D,F]=(0,s.useState)(!1),[E,I]=(0,s.useState)(!1),[_,P]=(0,s.useState)(!1),[T,L]=(0,s.useState)({}),[J,M]=(0,s.useState)(""),O=(0,s.useRef)(null),z=(0,s.useRef)(null);(0,s.useEffect)(()=>{let e=localStorage.getItem("userId"),t=localStorage.getItem("userName")||"",a=localStorage.getItem("userEmail")||"";r({id:e||"",name:t,email:a,department:localStorage.getItem("userDepartment")||"",office:localStorage.getItem("userOffice")||""}),(async()=>{try{let e=await fetch("http://localhost:5000/api/items/get");if(e.ok){let t=await e.json(),r=(Array.isArray(t)?t:t.data||t.items||[]).map(e=>({id:e.id||e._id||"",name:e.itemName||e.name||""}));w(r)}else console.warn("Failed to fetch items",e.status)}catch(e){console.error("Error fetching products:",e)}})()},[]);let B=async e=>{if(e&&t.id){F(!0);try{let r=await fetch("http://localhost:5000/api/currentstockouts/quantity?user_id=".concat(t.id,"&item_id=").concat(e));if(r.ok){let t=await r.json(),a=0;Array.isArray(t)&&t.length>0?a=t[0].quantity||0:void 0!==t.totalQuantity?a=t.totalQuantity:void 0!==t.quantity&&(a=t.quantity),A(t=>({...t,[e]:a}))}}catch(e){console.error("Error fetching stock count:",e)}finally{F(!1)}}},Q=e=>{if(Z("productName",e),e.trim().length>0){let t=j.filter(t=>t.name.toLowerCase().includes(e.toLowerCase()));q(t),C(t.length>0)}else C(!1),q([])},$=e=>{x(t=>({...t,productName:e.name})),C(!1),q([]),L(e=>{let t={...e};return delete t.productName,delete t.quantity,t}),B(e.id)},H=()=>{v(null),N(""),z.current&&(z.current.value="")},U=()=>{let e={};g.productName.trim()||(e.productName="Product name is required");let r=g.quantity.trim();if(r){let t=Number(r);if(isNaN(t)||t<=0)e.quantity="Quantity must be a positive number";else{let r=j.find(e=>e.name===g.productName);if(r){let a=R[r.id]||0;t>a&&(e.quantity="Quantity cannot exceed available stock (".concat(a," available)"))}}}else e.quantity="Quantity is required";return g.reason.trim()||(e.reason="Reason for dead stock is required"),y||(e.image="Image is required"),t.id&&"undefined"!==t.id&&""!==t.id.trim()||(e.user="User information not found. Please log in again."),L(e),0===Object.keys(e).length},V=async e=>{if(e.preventDefault(),M(""),P(!1),U()){if(!t.id||"undefined"===t.id||""===t.id.trim()){M("Error: User ID not found. Please log in again.");return}I(!0);try{var r;let e;let a=j.find(e=>e.name===g.productName);if(!a){L({productName:"Please select a product from the dropdown list"}),I(!1);return}let s=null===(r=t.id)||void 0===r?void 0:r.toString(),o=a.id,l=Number.parseInt(g.quantity),i=g.reason||"",n=new FormData;n.append("user_id",s),n.append("item_id",o),n.append("quantity",l.toString()),n.append("reason",i),y&&n.append("image",y,y.name);let d=await fetch("http://localhost:5000/api/deadstockrequests/create",{method:"POST",body:n}),c=await d.text();try{e=JSON.parse(c)}catch(e){console.error("Failed to parse response as JSON",e),M("Server error (".concat(d.status,"): ").concat(c||"No response body")),I(!1);return}if(!d.ok){console.error("Error from backend:",e);let t=e.message||e.error||"Error submitting form. Please try again.";M(t);return}P(!0),x({productName:"",quantity:"",reason:""}),v(null),N(""),L({})}catch(e){console.error("Error submitting form:",e),M(e instanceof Error?e.message:"An error occurred. Please try again.")}finally{I(!1)}}},Z=(e,t)=>{x(r=>({...r,[e]:t})),T[e]&&L(t=>{let r={...t};return delete r[e],r})};return(0,a.jsxs)("div",{className:"max-w-4xl mx-auto p-4",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("div",{className:"flex items-center space-x-4 mb-4",children:(0,a.jsx)(h(),{href:"/",children:(0,a.jsxs)(l.$,{variant:"outline",size:"sm",className:"bg-transparent",style:{borderColor:"#e7e7e7",color:"#51247a"},children:[(0,a.jsx)(u.A,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]})})}),(0,a.jsx)("h2",{className:"text-2xl font-bold mb-2",style:{color:"#51247a"},children:"Report Dead Stock"}),(0,a.jsx)("p",{style:{color:"#666"},children:"Submit a dead stock report for admin review and processing"})]}),(0,a.jsxs)(o.Zp,{style:{borderColor:"#e7e7e7",backgroundColor:"#ffffff"},children:[(0,a.jsxs)(o.aR,{children:[(0,a.jsx)(o.ZB,{style:{color:"#51247a"},children:"Dead Stock Report Details"}),(0,a.jsx)(o.BT,{style:{color:"#666"},children:"Fill in all required fields. Your report will be reviewed by the admin."})]}),(0,a.jsx)(o.Wu,{children:(0,a.jsxs)("form",{onSubmit:V,className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(n.J,{style:{color:"#51247a"},children:"Your Name"}),(0,a.jsx)("div",{className:"px-3 py-2 bg-gray-50 rounded-md border",style:{borderColor:"#e7e7e7",color:"#666"},children:t.name||"Loading..."})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2 relative",children:[(0,a.jsx)(n.J,{htmlFor:"productName",style:{color:"#51247a"},children:"Product Name *"}),(0,a.jsx)(i.p,{id:"productName",ref:O,value:g.productName,onChange:e=>Q(e.target.value),onFocus:()=>{j.length>0&&(q(g.productName.trim()?j.filter(e=>e.name.toLowerCase().includes(g.productName.toLowerCase())):j),C(!0))},onBlur:()=>{setTimeout(()=>C(!1),200)},placeholder:"Enter or select product name",autoComplete:"off",style:{borderColor:T.productName?"#ef4444":"#e7e7e7"}}),k&&S.length>0&&(0,a.jsx)("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border rounded-md shadow-lg z-10",style:{borderColor:"#e7e7e7"},children:S.slice(0,8).map((e,t)=>(0,a.jsx)("button",{type:"button",className:"w-full text-left px-3 py-2 hover:bg-gray-100",onClick:()=>$(e),children:(0,a.jsx)("div",{style:{color:"#51247a"},className:"font-medium",children:e.name})},t))}),T.productName&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:T.productName})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(n.J,{htmlFor:"quantity",style:{color:"#51247a"},children:["Quantity * ",g.productName&&(0,a.jsx)("span",{style:{color:"#666"},className:"text-sm font-normal",children:D?" (Loading stock...)":(0,a.jsxs)(a.Fragment,{children:[" ","(Available:"," ",R[(null===(e=j.find(e=>e.name===g.productName))||void 0===e?void 0:e.id)||""]||0,")"]})})]}),(0,a.jsx)(i.p,{id:"quantity",type:"number",value:g.quantity,onChange:e=>Z("quantity",e.target.value),placeholder:"Enter quantity of dead stock",style:{borderColor:T.quantity?"#ef4444":"#e7e7e7"}}),T.quantity&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:T.quantity})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(n.J,{htmlFor:"reason",style:{color:"#51247a"},children:"Reason for Dead Stock *"}),(0,a.jsx)(d.T,{id:"reason",value:g.reason,onChange:e=>Z("reason",e.target.value),placeholder:"Enter reason for marking this item as dead stock (e.g., expired, damaged, obsolete, etc.)",style:{borderColor:T.reason?"#ef4444":"#e7e7e7"},rows:5}),T.reason&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:T.reason})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(n.J,{htmlFor:"image",style:{color:"#51247a"},children:"Upload Image *"}),(0,a.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-6 text-center cursor-pointer hover:bg-gray-50 transition",style:{borderColor:T.image?"#ef4444":"#e7e7e7",backgroundColor:T.image?"#fef2f2":"transparent"},onClick:()=>{var e;return null===(e=z.current)||void 0===e?void 0:e.click()},children:[(0,a.jsx)("input",{ref:z,type:"file",id:"image",accept:"image/*",onChange:e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){v(r);let e=new FileReader;e.onloadend=()=>{N(e.result)},e.readAsDataURL(r),T.image&&L(e=>{let t={...e};return delete t.image,t})}},className:"hidden"}),b?(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("img",{src:b||"/placeholder.svg",alt:"Preview",className:"max-h-48 mx-auto rounded"}),(0,a.jsx)("p",{style:{color:"#51247a"},className:"font-medium",children:null==y?void 0:y.name}),(0,a.jsx)(l.$,{type:"button",variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),H()},style:{borderColor:"#e7e7e7",color:"#51247a"},children:"Change Image"})]}):(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(m.A,{className:"w-8 h-8 mx-auto",style:{color:"#51247a"}}),(0,a.jsx)("p",{style:{color:"#51247a"},className:"font-medium",children:"Click to upload image"}),(0,a.jsx)("p",{style:{color:"#999"},className:"text-sm",children:"or drag and drop"})]})]}),T.image&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:T.image})]}),J&&(0,a.jsx)(c.Fc,{className:"border-red-300 bg-red-50",children:(0,a.jsx)(c.TN,{style:{color:"#dc2626"},children:J})}),_&&(0,a.jsx)(c.Fc,{className:"border-green-300 bg-green-50",style:{borderColor:"#22c55e",backgroundColor:"#f0fdf4"},children:(0,a.jsx)(c.TN,{style:{color:"#16a34a"},children:"Dead stock report submitted successfully! Your report is now pending admin review."})}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsxs)(l.$,{type:"submit",disabled:E,className:"flex-1",style:{backgroundColor:"#51247a",color:"white",opacity:E?.7:1},children:[(0,a.jsx)(f.A,{className:"w-4 h-4 mr-2"}),E?"Submitting...":"Submit Report"]}),(0,a.jsxs)(l.$,{type:"button",variant:"outline",onClick:()=>{x({productName:"",quantity:"",reason:""}),v(null),N(""),L({}),P(!1),M(""),A({})},style:{borderColor:"#e7e7e7",color:"#51247a"},children:[(0,a.jsx)(p.A,{className:"w-4 h-4 mr-2"}),"Clear Form"]})]})]})})]}),"true"===localStorage.getItem("debug")&&(0,a.jsxs)("div",{className:"mt-4 p-4 border rounded bg-gray-50",children:[(0,a.jsx)("h3",{className:"font-semibold mb-2",children:"Debug Info"}),(0,a.jsx)("pre",{className:"text-xs",children:JSON.stringify({currentUser:t,formData:g,hasImage:!!y,productsCount:j.length},null,2)})]})]})}},87812:(e,t,r)=>{"use strict";r.d(t,{p:()=>l});var a=r(73365),s=r(1521),o=r(69671);let l=s.forwardRef((e,t)=>{let{className:r,type:s,...l}=e;return(0,a.jsx)("input",{type:s,className:(0,o.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...l})});l.displayName="Input"}},e=>{var t=t=>e(e.s=t);e.O(0,[3096,9924,2347,4870,7358],()=>t(642)),_N_E=e.O()}]);